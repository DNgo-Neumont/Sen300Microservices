<!doctype html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>S-Mart | Shop Here</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
        <link href="./css/baseColors.css" rel="stylesheet" type="text/css">
        <script src="./javascript/quantityButton.js"></script>
    </head>
    <body onload="createProducts()">
        <section class="section-products">
            <div class="container">
                <div class="row justify-content-md-center" style="text-align: center;">
                    <h1>S-Mart</h1>
                    <h3 class="basic">Shop Smart, Shop S-Mart</h3>
                </div>
            </div>
            <div id="productList" class="container">

            </div>
        </section>
        <div class="container-fluid pt-5" id="products">
        </div>
        <script>
            function createProducts() {
                var productList = document.getElementById("productList");
                for(var i = 0; i < 3; i++) {
                    var productRow = document.createElement("div");
                    productRow.classList.add("row")
                    productRow.classList.add("justify-content-md-center");
                    productRow.style = "text-align: center; padding-top: 20px;"

                    const request = new XMLHttpRequest();
                    request.open("GET","http://localhost:5000/itemAPI/getInventory");
                    request.setRequestHeader("Content-Type", "application/json;charset=UTF-8")
                    request.send();
                    request.onload = () => {
                        var allStuff = JSON.parse(request.responseText);
                        console.log(allStuff);
                    }
                    
                    for(var j = 0; j < 4; j++) {
                        var productContent = document.createElement("div");
                        productContent.id = 1;
                        productContent.classList.add("col-3");
                        productContent.classList.add("backgroundDat");

                        var productName = document.createElement("h3");
                        productName.textContent = "(" + i + "," + j +")"

                        var productDescription = document.createElement("div");
                        productContent.innerHTML = "";

                        var productQuanityButton = document.createElement("div")
                        productQuanityButton.classList.add("col");
                        productQuanityButton.innerHTML = `
                            <div class="input-group">
                                <button type="button" class="quantity-left-minus btn btn-number btnColorP"  data-type="minus" data-field="">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <input type="text" id="quantity" name="quantity" class="form-control input-number" value="0" min="1" max="100">
                                <button type="button" class="quantity-right-plus btn btn-number btnColorP" data-type="plus" data-field="">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        `

                        var buttonCheckout = document.createElement("div")
                        buttonCheckout.classList.add("col");
                        buttonCheckout.style = "padding-top: 10px;"
                        buttonCheckout.innerHTML += `
                        <button type="button" class="add-quanity btn btnColorB" data-type="plus" data-field="">
                            <b>Add To Cart   </b><i class="fa fa-shopping-cart"></i>
                        </button>
                        `

                        productContent.appendChild(productName);
                        productContent.appendChild(productDescription);
                        productContent.appendChild(productQuanityButton);
                        productContent.appendChild(buttonCheckout);


                        productRow.appendChild(productContent);
                    }                    
                    productList.appendChild(productRow);
                }
                createButtons();
            }

            function createButtons() {
                var decreaseQuantity = document.getElementsByClassName("quantity-left-minus");
                var increaseQuantity = document.getElementsByClassName("quantity-right-plus");
                var addToBasket = document.getElementsByClassName("add-quanity");

                for (var i = 0; i < increaseQuantity.length; i++) {
                    var buttonInc = increaseQuantity[i];
                    buttonInc.addEventListener('click', function(event) {
                        var buttonClickedInc = event.target;
                        var inputInc = buttonClickedInc.parentElement.parentElement.children[1];
                        var inputValueInc = parseInt(inputInc.value);
                        inputInc.value = parseInt(inputValueInc) + 1;
                    });
                }
                for (var i = 0; i < decreaseQuantity.length; i++) {
                    var buttonDesc = decreaseQuantity[i];
                    buttonDesc.addEventListener('click', function(event) {
                        var buttonClickedDesc = event.target;
                        var inputDesc = buttonClickedDesc.parentElement.parentElement.children[1];
                        console.log(inputDesc);
                        var inputValueDesc = parseInt(inputDesc.value);
                        if (inputValueDesc > 0) {
                            inputDesc.value = inputValueDesc - 1;
                        }
                    })
                }
                for (var i = 0; i < addToBasket.length; i++) {
                    var buttonAddToCart = addToBasket[i];
                    buttonAddToCart.addEventListener('click', function(event) {
                        var buttonClickedCart = event.target;
                        var idProduct = buttonClickedCart.parentElement.parentElement.parentElement.id;
                        var quantityProduct = buttonClickedCart.parentElement.parentElement.parentElement.children[2].children[0].children[1].value;

                        const request = new XMLHttpRequest(); 
			            var theUrl = "/addItem";
			            request.open("POST", theUrl);
			            request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			            request.send(JSON.stringify({"id": parseLong(idProduct), "quantity": parseInt(quantityProduct)}));
			            request.onload = ()=> {
				            console.log(request.responseText);
				            document.querySelector("#myResponse").innerHTML = request.responseText;
			            };
                    })
                }
            }
        </script>
    </body>
</html>